<dialog-form>
  <section class="content-header">
    <h1>
      对话
      <small>编辑或查看对话</small>
    </h1>
    <ol class="breadcrumb">
      <li><a href="#"><i class="fa fa-dashboard"></i> 主页</a></li>
      <li><a href="/#!dialog">对话列表</a></li>
      <li class="active">编辑对话</li>
    </ol>
  </section>
  <section class="content">
    <div class="row">
      <div class="col-md-12">
        <div class="box box-primary">
          <form role="form">
            <input name="id" type="hidden">
            <div class="box-body">
              <div class="form-group">
                <label for="type">对话场景类型</label>
                <select class="form-control select2" name="type" style="width: 100%;">
                  <option selected="selected">聊天类</option>
                  <option>笑话类</option>
                  <option>绕口令</option>
                  <option>诗歌类</option>
                  <option>计算</option>
                  <option>英语</option>
                  <option>生活</option>
                </select>
              </div>
              <div class="form-group">
                <label for="desc">对话描述</label>
                <input type="text" class="form-control" name="name" placeholder="对话描述">
              </div>
              <div class="row">
                <div class="col-md-6">
                  <div class="box box-info box-solid">
                    <div class="box-header">
                      <h3 class="box-title">问题列表</h3>
                    </div>
                    <div class="box-body no-padding">
                      <table class="table table-striped">
                        <tbody>
                          <tr>
                            <th style="width: 10px">#</th>
                            <th>内容</th>
                            <th style="width: 50px">操作</th>
                          </tr>
                          <tr each={q, i in queList}>
                            <td>{i + 1}</td>
                            <td>{q}</td>
                            <td><span class="btn badge bg-red" onclick={delQue}>删除</span></td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                    <div class="box-footer">
                      <div class="input-group">
                        <input type="text" class="form-control" name="newque" placeholder="输入问题添加到列表" onkeypress={addQue}>
                        <div class="input-group-addon btn" onclick={addQue}>
                          <i class="fa fa-plus"></i>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="box box-warning box-solid">
                    <div class="box-header">
                      <h3 class="box-title">答案列表</h3>
                    </div>
                    <div class="box-body no-padding">
                      <table class="table table-striped">
                        <tbody>
                          <tr>
                            <th style="width: 10px">#</th>
                            <th>内容</th>
                            <th style="width: 50px">操作</th>
                          </tr>
                          <tr each={a, i in ansList}>
                            <td>{i + 1}</td>
                            <td>{a}</td>
                            <td><span class="btn badge bg-red" onclick={delAns}>删除</span></td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                    <div class="box-footer">
                      <div class="input-group">
                        <input type="text" class="form-control" name="newans" placeholder="输入答案添加到列表" onkeypress={addAns}>
                        <div class="input-group-addon btn" onclick={addAns}>
                          <i class="fa fa-plus"></i>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="box-footer">
              <button type="button" class="btn btn-primary" onclick={saveDialog}>保存</button>
              <button type="button" class="btn btn-cancel" onclick={cancel}>取消</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </section>
  <script>
  var _this = this;
  this.queList = [];
  this.ansList = [];

  this.on('mount', function() {
    $('.select2').select2();
  });

  add(key, e) {
    var newkey = 'new' + key;
    var listkey = key + 'List';
    if (!this[newkey].value) {
      return true;
    }

    if ((e instanceof KeyboardEvent && e.which == 13) || e instanceof MouseEvent) {
      this[listkey].push(this[newkey].value);
      this.update();
      this[newkey].value = '';
    }
  }

  del(key, e) {
    this[key + 'List'].splice(e.item.i, 1);
    this.update();
  }

  addQue(e) {
    this.add('que', e);
    return true
  }

  addAns(e) {
    this.add('ans', e);
    return true;
  }

  delQue(e) { this.del('que', e); }
  delAns(e) { this.del('ans', e); }

  saveDialog() {
    var formData = {
      id: this.id.value,
      type: this.type.value,
      name: this.name.value,
      queList: this.queList,
      ansList: this.ansList
    }
    console.log(formData);
    // location.href = '/#!dialog';
  }
  
  cancel() {
    location.href = '/#!dialog';
  }
  </script>
</dialog-form>
